@using VocaDb.Model.DataContracts.Users;
@using VocaDb.Web;
@using VocaDb.Web.Helpers;
@using VocaDb.Model.Domain.Security;
@using R = ViewRes.User;
@model UserDetailsContract
		   
@{
	ViewBag.Title = R.DetailsStrings.UserDetails + " - " + Model.Name;
	ViewBag.Parents = new[] { 
		Html.ActionLink(ViewRes.SharedStrings.Users, "Index"), 
	};

	var ownProfile = (Login.Manager.IsLoggedIn && Login.User.Id == Model.Id && Login.User.Active);
	var canSeeDetailedStats = (ownProfile || !Model.AnonymousActivity || Login.CanModerateUsers);
			
}

@section Toolbar {
@if (ownProfile) {
	@Html.ActionLink(R.DetailsStrings.MySettings, "MySettings", null, new { id = "mySettingsLink" });
	@Html.Raw("&nbsp;")
	@Html.ActionLink(R.DetailsStrings.Messages, "Messages", null, new { id = "messagesLink" });
}

@if (Login.Manager.IsLoggedIn && Login.User.Id != Model.Id && Login.User.Active) {
	//@Html.ActionLink("Compose message", "Messages", null, null, null, "composeTab", new { ReceiverName = Model.Name }, new { id = "composeMessageLink" });
}
@if (Login.CanManageUsers) {
	@Html.Raw("&nbsp;")
	@Html.ActionLink(ViewRes.SharedStrings.Edit, "Edit", new { id = Model.Id }, new { id = "editUserLink" });
}
@if (Login.Manager.HasPermission(PermissionToken.DisableUsers) && Login.User.Id != Model.Id && Model.Active) {
	@Html.Raw("&nbsp;")
	@Html.ActionLink(R.DetailsStrings.Disable, "Disable", new { id = Model.Id }, new { id = "disableUserLink" });
}
}

<table>
	<tr>
		<td rowspan="7" class="alignTop">
			@Html.ProfileIcon(Model)
		</td>
		<td>@ViewRes.SharedStrings.Name</td>
		<td>
			@Model.Name<br />
		</td>
	</tr>
	<tr>
		<td>@R.DetailsStrings.UserGroup</td>
		<td>@Translate.UserGroups[Model.GroupId]</td>
	</tr>
	<tr>
		<td>@R.DetailsStrings.MemberSince</td>
		<td>@Model.CreateDate.ToShortDateString()</td>
	</tr>
	@if (Login.CanManageUsers || ownProfile) {
		<tr>
			<td>@R.DetailsStrings.LastLogin</td>
			<td>@Model.LastLogin</td>
		</tr>
		<tr>
			<td>@R.DetailsStrings.AdditionalPermissions</td>
			<td>@Translate.AllPermissionTokenNames(Model.AdditionalPermissions)</td>
		</tr>
 }
	@if (Login.Manager.HasPermission(PermissionToken.DisableUsers)) {
		<tr>
			<td>@R.DetailsStrings.Active</td>
			<td>@Model.Active</td>
		</tr>
		<tr>
			<td>@R.DetailsStrings.EffectivePermissions</td>
			<td>@Translate.AllPermissionTokenNames(Model.EffectivePermissions)</td>
		</tr>	 
 }
</table>

<br />

<div id="tabs">

	<ul>
		<li><a href="#stats">@R.DetailsStrings.StatsTab</a></li>
		<li><a href="@Url.Action("AlbumCollection", "User", new { id = Model.Id })" title="Collection"><span>@R.DetailsStrings.CollectionTab (@Model.AlbumCollectionCount)</span></a></li>
		<li><a href="@Url.Action("Artists", "User", new { id = Model.Id })" title="Followed artists"><span>@R.DetailsStrings.FollowedArtistsTab (@Model.ArtistCount)</span></a></li>
		<li><a href="@Url.Action("FavoriteSongsPaged", "User", new { id = Model.Id })" title="Favorite songs"><span>@R.DetailsStrings.FavoriteSongsTab (@Model.FavoriteSongCount)</span></a></li>
		<li><a href="#customLists">@R.DetailsStrings.CustomListsTab</a></li>
	</ul>

	<div id="stats">
		<p>
			@{ var submitText = R.DetailsStrings.Submissions + ": " + Model.SubmitCount; }
			@if (canSeeDetailedStats) {
				<text>@Html.ActionLink(submitText, "EntryEdits", new { id = Model.Id, onlySubmissions = true })</text>
   } else {
				<text>@submitText</text>
   }
		</p>
		<p>
			@{ var editText = R.DetailsStrings.TotalEdits + ": " + Model.EditCount; }
			@if (canSeeDetailedStats) {
				@Html.ActionLink(editText, "EntryEdits", new { id = Model.Id, onlySubmissions = false })
   } else {
				<text>@editText</text>
   }
		</p>
		<p>@R.DetailsStrings.Comments: @Model.CommentCount</p>
		<p>@R.DetailsStrings.TagVotes: @Model.TagVotes</p>
	</div>

	<div id="Collection">
	</div>

	<div id="Followed_artists">
	</div>

	<div id="Favorite_songs">
	</div>

	<div id="customLists">
		@SongHelpers.SongLists(Model.SongLists)

		@if (ownProfile) {
			<a href="@Url.Action("Edit", "SongList")" class="textLink addLink">@R.DetailsStrings.CreateNewList</a>
  }
	</div>

</div>

<link rel="stylesheet" href="@Url.Content("~/Content/Styles/Pager.css")" type="text/css" />
<script type="text/javascript" src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.min.js")"></script>
<script type="text/javascript" src="../../Scripts/User/Details.js"></script>
<script type="text/javascript">

	$(document).ready(function() { 
		initPage(@Model.Id, "@ViewRes.SharedStrings.Loading", "@R.DetailsStrings.ConfirmDisable");
	});

</script>