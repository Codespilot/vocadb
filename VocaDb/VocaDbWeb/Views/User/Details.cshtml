@using VocaDb.Model.DataContracts.Users;
@using VocaDb.Web;
@using VocaDb.Web.Helpers;
@using VocaDb.Model.Domain.Security;
@model UserDetailsContract
		   
@{
	ViewBag.Title = "User details - " + Model.Name;
	ViewBag.Parents = new[] { 
		Html.ActionLink("Users", "Index"), 
	};		
}

@section Toolbar {
@if (Login.Manager.IsLoggedIn && Login.User.Id == Model.Id && Login.User.Active) {
	@Html.ActionLink("My settings", "MySettings", null, new { id = "mySettingsLink" });
	@Html.ActionLink("Messages", "Messages", null, new { id = "messagesLink" });
}

@if (Login.Manager.IsLoggedIn && Login.User.Id != Model.Id && Login.User.Active) {
	//@Html.ActionLink("Compose message", "Messages", null, null, null, "composeTab", new { ReceiverName = Model.Name }, new { id = "composeMessageLink" });
}
@if (Login.CanManageUsers) {
	<text>&nbsp;</text>
	@Html.ActionLink("Edit", "Edit", new { id = Model.Id }, new { id = "editUserLink" });
}
@if (Login.Manager.HasPermission(PermissionFlags.ManageUserBlocks) && Login.User.Id != Model.Id && Model.Active) {
	<text>&nbsp;</text>
	@Html.ActionLink("Disable", "Disable", new { id = Model.Id }, new { id = "disableUserLink" });
}
}

<table>
	<tr>
		<td rowspan="6" class="alignTop">
			@Html.ProfileIcon(Model)
		</td>
		<td>Name</td>
		<td>
			@Model.Name<br />
		</td>
	</tr>
	<tr>
		<td>User level</td>
		<td>@Model.GroupId</td>
	</tr>
	<tr>
		<td>A member since</td>
		<td>@Model.CreateDate.ToShortDateString()</td>
	</tr>
	@if (Login.CanManageUsers || (Login.Manager.IsLoggedIn && Login.User.Id == Model.Id)) {
		<tr>
			<td>Last login</td>
			<td>@Model.LastLogin</td>
		</tr>
		<tr>
			<td>Additional permissions</td>
			<td>@Model.AdditionalPermissions</td>
		</tr>
	}
	@if (Login.Manager.HasPermission(PermissionFlags.ManageUserBlocks)) {
		<tr>
			<td>Active</td>
			<td>@Model.Active</td>
		</tr>
	}
</table>

<br />

<div id="tabs">

	<ul>
		<li><a href="#collection">Collection</a></li>
		<li><a href="#favorites">Favorites</a></li>
	</ul>

	<div id="collection">
		<table>
			<tr>
				<th colspan="2">Album</th>
				<th>Media type</th>
			</tr>
			@foreach (var album in Model.AlbumLinks) {
			<tr>
				<td>
					<img src="@Url.Action("CoverPictureThumb", "Album", new { id = album.Album.Id })" alt="Cover" class="coverPicIcon" />
				</td>
				<td>
					@Html.ActionLink(album.Album.Name, "Details", "Album", new { id = album.Album.Id }, new { title = album.Album.AdditionalNames })
					<br />
					<span class="extraInfo">@album.Album.ArtistString</span>
				</td>
				<td>
					@Translate.MediaTypeName(album.MediaType)
				</td>	
			</tr>
   }	
		</table>
	</div>

	<div id="favorites">
		<ul>
		@foreach (var song in Model.FavoriteSongs) {
			<li>
				@Html.ActionLink(song.Song.Name, "Details", "Song", new { id = song.Song.Id }, new { title = song.Song.AdditionalNames })<br />
				<span class="extraInfo">@song.Song.ArtistString</span>
			</li>
  }
		</ul>	
	</div>
</div>

<script type="text/javascript" src="../../Scripts/User/Details.js"></script>
<script type="text/javascript">

	$(document).ready(function() { 
		initPage(@Model.Id) 
	});

</script>